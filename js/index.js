(function() {
  var COLORS, FRICTION, GRAVITY, MAX_FORCE, NUM_PARTICLES, Particle, TAIL_LENGTH;

  NUM_PARTICLES = 250;

  TAIL_LENGTH = 1;

  MAX_FORCE = 8;

  FRICTION = 0.89;

  GRAVITY = 1;

  COLORS = ['#c0c0c0'];

  Particle = class Particle {
    constructor(x1 = 0.0, y1 = 0.0, mass = 1.0) {
      this.x = x1;
      this.y = y1;
      this.mass = mass;
      this.tail = [];
      this.radius = this.mass * 0.15;
      this.charge = random([-1, 1]);
      this.color = random(COLORS);
      this.fx = this.fy = 0.0;
      this.vx = this.vy = 0.0;
    }

  };

  Sketch.create({
    retina: 'auto',
    particles: [],
    setup: function() {
      var i, k, m, ref, results, x, y;
      results = [];
      for (i = k = 0, ref = NUM_PARTICLES; k <= ref; i = k += 1) {
        x = random(this.width);
        y = random(this.height);
        m = random(0.5, 8.0);
        results.push(this.particles.push(new Particle(x, y, m)));
      }
      return results;
    },
    draw: function() {
      var a, b, dSq, dst, dx, dy, f, fx, fy, i, j, k, l, len, len1, n, p, rad, ref, ref1, ref2, ref3, results;
      this.lineCap = this.lineJoin = 'round';
      results = [];
      for (i = k = 0, ref = NUM_PARTICLES; k <= ref; i = k += 1) {
        a = this.particles[i];
        // invert charge
        if (random() < 0.08) {
          a.charge = -a.charge;
        }
        for (j = l = ref1 = i + 1, ref2 = NUM_PARTICLES; l <= ref2; j = l += 1) {
          b = this.particles[j];
          
          // delta vector
          dx = b.x - a.x;
          dy = b.y - a.y;
          
          // distance
          dst = sqrt(dSq = (dx * dx + dy * dy) + 0.1);
          rad = a.radius + b.radius;
          if (dst >= rad) {
            
            // derivative of unit length for normalisation
            len = 1.0 / dst;
            fx = dx * len;
            fy = dy * len;
            
            // gravitational force
            f = min(MAX_FORCE, (GRAVITY * a.mass * b.mass) / dSq);
            a.fx += f * fx * b.charge;
            a.fy += f * fy * b.charge;
            b.fx += -f * fx * a.charge;
            b.fy += -f * fy * a.charge;
          }
        }
        
        // integrate
        a.vx += a.fx;
        a.vy += a.fy;
        a.vx *= FRICTION;
        a.vy *= FRICTION;
        a.tail.unshift({
          x: a.x,
          y: a.y
        });
        if (a.tail.length > TAIL_LENGTH) {
          a.tail.pop();
        }
        a.x += a.vx;
        a.y += a.vy;
        
        // reset force
        a.fx = a.fy = 0.0;
        
        // wrap
        if (a.x > this.width + a.radius) {
          a.x = -a.radius;
          a.tail = [];
        } else if (a.x < -a.radius) {
          a.x = this.width + a.radius;
          a.tail = [];
        }
        if (a.y > this.height + a.radius) {
          a.y = -a.radius;
          a.tail = [];
        } else if (a.y < -a.radius) {
          a.y = this.height + a.radius;
          a.tail = [];
        }
        
        // draw
        this.strokeStyle = a.color;
        this.lineWidth = a.radius * 2.0;
        this.beginPath();
        this.moveTo(a.x, a.y);
        ref3 = a.tail;
        for (n = 0, len1 = ref3.length; n < len1; n++) {
          p = ref3[n];
          this.lineTo(p.x, p.y);
        }
        results.push(this.stroke());
      }
      return results;
    }
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiPGFub255bW91cz4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0E7QUFBQSxNQUFBLE1BQUEsRUFBQSxRQUFBLEVBQUEsT0FBQSxFQUFBLFNBQUEsRUFBQSxhQUFBLEVBQUEsUUFBQSxFQUFBOztFQUFBLGFBQUEsR0FBZ0I7O0VBQ2hCLFdBQUEsR0FBYzs7RUFDZCxTQUFBLEdBQVk7O0VBQ1osUUFBQSxHQUFXOztFQUNYLE9BQUEsR0FBVTs7RUFFVixNQUFBLEdBQVMsQ0FDUCxTQURPOztFQUlILFdBQU4sTUFBQSxTQUFBO0lBRUUsV0FBYSxNQUFPLEdBQVAsT0FBaUIsR0FBakIsU0FBOEIsR0FBOUIsQ0FBQTtNQUFFLElBQUMsQ0FBQTtNQUFTLElBQUMsQ0FBQTtNQUFTLElBQUMsQ0FBQTtNQUVsQyxJQUFDLENBQUEsSUFBRCxHQUFRO01BRVIsSUFBQyxDQUFBLE1BQUQsR0FBVSxJQUFDLENBQUEsSUFBRCxHQUFRO01BQ2xCLElBQUMsQ0FBQSxNQUFELEdBQVUsTUFBQSxDQUFPLENBQUUsQ0FBQyxDQUFILEVBQU0sQ0FBTixDQUFQO01BQ1YsSUFBQyxDQUFBLEtBQUQsR0FBUyxNQUFBLENBQU8sTUFBUDtNQUVULElBQUMsQ0FBQSxFQUFELEdBQU0sSUFBQyxDQUFBLEVBQUQsR0FBTTtNQUNaLElBQUMsQ0FBQSxFQUFELEdBQU0sSUFBQyxDQUFBLEVBQUQsR0FBTTtJQVREOztFQUZmOztFQWFBLE1BQU0sQ0FBQyxNQUFQLENBRUU7SUFBQSxNQUFBLEVBQVEsTUFBUjtJQUVBLFNBQUEsRUFBVyxFQUZYO0lBSUEsS0FBQSxFQUFPLFFBQUEsQ0FBQSxDQUFBO0FBRUwsVUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUEsT0FBQSxFQUFBLENBQUEsRUFBQTtBQUFBO01BQUEsS0FBUyxvREFBVDtRQUVFLENBQUEsR0FBSSxNQUFBLENBQU8sSUFBQyxDQUFBLEtBQVI7UUFDSixDQUFB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OztJQUpJO0VBZE4sQ0FGRjtBQXZCQSIsInNvdXJjZXNDb250ZW50IjpbIlxuTlVNX1BBUlRJQ0xFUyA9IDI1MFxuVEFJTF9MRU5HVEggPSAxXG5NQVhfRk9SQ0UgPSA4XG5GUklDVElPTiA9IDAuODlcbkdSQVZJVFkgPSAxXG4gIFxuQ09MT1JTID0gW1xuICAnI2MwYzBjMCdcbiAgXVxuICBcbmNsYXNzIFBhcnRpY2xlXG4gIFxuICBjb25zdHJ1Y3RvcjogKCBAeCA9IDAuMCwgQHkgPSAwLjAsIEBtYXNzID0gMS4wICkgLT5cblxuICAgIEB0YWlsID0gW11cbiAgICBcbiAgICBAcmFkaXVzID0gQG1hc3MgKiAwLjE1XG4gICAgQGNoYXJnZSA9IHJhbmRvbSBbIC0xLCAxIF1cbiAgICBAY29sb3IgPSByYW5kb20gQ09MT1JTXG4gICAgXG4gICAgQGZ4ID0gQGZ5ID0gMC4wXG4gICAgQHZ4ID0gQHZ5ID0gMC4wXG4gICAgXG5Ta2V0Y2guY3JlYXRlXG5cbiAgcmV0aW5hOiAnYXV0bydcbiAgXG4gIHBhcnRpY2xlczogW11cbiAgICBcbiAgc2V0dXA6IC0+XG4gICAgXG4gICAgZm9yIGkgaW4gWzAuLk5VTV9QQVJUSUNMRVNdIGJ5IDFcbiAgICAgIFxuICAgICAgeCA9IHJhbmRvbSBAd2lkdGhcbiAgICAgIHkgPSByYW5kb20gQGhlaWdodFxuICAgICAgbSA9IHJhbmRvbSAwLjUsIDguMFxuICAgICAgICBcbiAgICAgIEBwYXJ0aWNsZXMucHVzaCBuZXcgUGFydGljbGUgeCwgeSwgbVxuICAgIFxuICBkcmF3OiAtPlxuXG4gICAgQGxpbmVDYXAgPSBAbGluZUpvaW4gPSAncm91bmQnXG5cbiAgICBmb3IgaSBpbiBbMC4uTlVNX1BBUlRJQ0xFU10gYnkgMVxuICAgICAgXG4gICAgICBhID0gQHBhcnRpY2xlc1tpXVxuXG4gICAgICAjIGludmVydCBjaGFyZ2VcbiAgICAgIGlmIHJhbmRvbSgpIDwgMC4wOCB0aGVuIGEuY2hhcmdlID0gLWEuY2hhcmdlXG4gICAgICBcbiAgICAgIGZvciBqIGluIFtpKzEuLk5VTV9QQVJUSUNMRVNdIGJ5IDFcbiAgICAgICAgXG4gICAgICAgIGIgPSBAcGFydGljbGVzW2pdXG4gICAgICAgIFxuICAgICAgICAjIGRlbHRhIHZlY3RvclxuICAgICAgICBkeCA9IGIueCAtIGEueFxuICAgICAgICBkeSA9IGIueSAtIGEueVxuICAgICAgICBcbiAgICAgICAgIyBkaXN0YW5jZVxuICAgICAgICBkc3QgPSBzcXJ0IGRTcSA9ICggZHggKiBkeCArIGR5ICogZHkgKSArIDAuMVxuICAgICAgICByYWQgPSBhLnJhZGl1cyArIGIucmFkaXVzXG4gICAgICAgIFxuICAgICAgICBpZiBkc3QgPj0gcmFkXG4gICAgICBcbiAgICAgICAgICAjIGRlcml2YXRpdmUgb2YgdW5pdCBsZW5ndGggZm9yIG5vcm1hbGlzYXRpb25cbiAgICAgICAgICBsZW4gPSAxLjAgLyBkc3RcbiAgICAgICAgXG4gICAgICAgICAgZnggPSBkeCAqIGxlblxuICAgICAgICAgIGZ5ID0gZHkgKiBsZW5cbiAgICAgICAgXG4gICAgICAgICAgIyBncmF2aXRhdGlvbmFsIGZvcmNlXG4gICAgICAgICAgZiA9IG1pbiBNQVhfRk9SQ0UsICggR1JBVklUWSAqIGEubWFzcyAqIGIubWFzcyApIC8gZFNxXG4gICAgICAgICAgICBcbiAgICAgICAgICBhLmZ4ICs9IGYgKiBmeCAqIGIuY2hhcmdlXG4gICAgICAgICAgYS5meSArPSBmICogZnkgKiBiLmNoYXJnZVxuICAgICAgICAgIFxuICAgICAgICAgIGIuZnggKz0gLWYgKiBmeCAqIGEuY2hhcmdlXG4gICAgICAgICAgYi5meSArPSAtZiAqIGZ5ICogYS5jaGFyZ2VcbiAgICAgICAgICBcbiAgICAgICMgaW50ZWdyYXRlXG4gICAgICBhLnZ4ICs9IGEuZnhcbiAgICAgIGEudnkgKz0gYS5meVxuICAgICAgICBcbiAgICAgIGEudnggKj0gRlJJQ1RJT05cbiAgICAgIGEudnkgKj0gRlJJQ1RJT05cblxuICAgICAgYS50YWlsLnVuc2hpZnQgeDogYS54LCB5OiBhLnlcbiAgICAgIGEudGFpbC5wb3AoKSBpZiBhLnRhaWwubGVuZ3RoID4gVEFJTF9MRU5HVEhcbiAgICAgICAgXG4gICAgICBhLnggKz0gYS52eFxuICAgICAgYS55ICs9IGEudnlcbiAgICAgICAgXG4gICAgICAjIHJlc2V0IGZvcmNlXG4gICAgICBhLmZ4ID0gYS5meSA9IDAuMFxuICAgICAgXG4gICAgICAjIHdyYXBcbiAgICAgICAgXG4gICAgICBpZiBhLnggPiBAd2lkdGggKyBhLnJhZGl1c1xuXG4gICAgICAgIGEueCA9IC1hLnJhZGl1c1xuICAgICAgICBhLnRhaWwgPSBbXVxuXG4gICAgICBlbHNlIGlmIGEueCA8IC1hLnJhZGl1c1xuXG4gICAgICAgIGEueCA9IEB3aWR0aCArIGEucmFkaXVzXG4gICAgICAgIGEudGFpbCA9IFtdXG4gICAgICBcbiAgICAgIGlmIGEueSA+IEBoZWlnaHQgKyBhLnJhZGl1c1xuXG4gICAgICAgIGEueSA9IC1hLnJhZGl1c1xuICAgICAgICBhLnRhaWwgPSBbXVxuXG4gICAgICBlbHNlIGlmIGEueSA8IC1hLnJhZGl1c1xuXG4gICAgICAgIGEueSA9IEBoZWlnaHQgKyBhLnJhZGl1c1xuICAgICAgICBhLnRhaWwgPSBbXVxuICAgICAgICAgIFxuICAgICAgIyBkcmF3XG4gICAgICBAc3Ryb2tlU3R5bGUgPSBhLmNvbG9yXG4gICAgICBAbGluZVdpZHRoID0gYS5yYWRpdXMgKiAyLjBcblxuICAgICAgQGJlZ2luUGF0aCgpXG4gICAgICBAbW92ZVRvIGEueCwgYS55XG4gICAgICBAbGluZVRvIHAueCwgcC55IGZvciBwIGluIGEudGFpbFxuICAgICAgQHN0cm9rZSgpXG4iXX0=
//# sourceURL=coffeescript