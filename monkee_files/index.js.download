(function() {
  var COLORS, FRICTION, GRAVITY, MAX_FORCE, NUM_PARTICLES, Particle, TAIL_LENGTH;

  NUM_PARTICLES = 1000;

  TAIL_LENGTH = 1;

  MAX_FORCE = 8;

  FRICTION = 0.89;

  GRAVITY = 1;

  COLORS = ['#c0c0c0'];

  Particle = class Particle {
    constructor(x1 = 0.0, y1 = 0.0, mass = 1.0) {
      this.x = x1;
      this.y = y1;
      this.mass = mass;
      this.tail = [];
      this.radius = this.mass * 0.15;
      this.charge = random([-1, 1]);
      this.color = random(COLORS);
      this.fx = this.fy = 0.0;
      this.vx = this.vy = 0.0;
    }

  };

  Sketch.create({
    retina: 'auto',
    particles: [],
    setup: function() {
      var i, k, m, ref, results, x, y;
      results = [];
      for (i = k = 0, ref = NUM_PARTICLES; k <= ref; i = k += 1) {
        x = random(this.width);
        y = random(this.height);
        m = random(0.5, 8.0);
        results.push(this.particles.push(new Particle(x, y, m)));
      }
      return results;
    },
    draw: function() {
      var a, b, dSq, dst, dx, dy, f, fx, fy, i, j, k, l, len, len1, n, p, rad, ref, ref1, ref2, ref3, results;
      this.lineCap = this.lineJoin = 'round';
      results = [];
      for (i = k = 0, ref = NUM_PARTICLES; k <= ref; i = k += 1) {
        a = this.particles[i];
        // invert charge
        if (random() < 0.08) {
          a.charge = -a.charge;
        }
        for (j = l = ref1 = i + 1, ref2 = NUM_PARTICLES; l <= ref2; j = l += 1) {
          b = this.particles[j];
          
          // delta vector
          dx = b.x - a.x;
          dy = b.y - a.y;
          
          // distance
          dst = sqrt(dSq = (dx * dx + dy * dy) + 0.1);
          rad = a.radius + b.radius;
          if (dst >= rad) {
            
            // derivative of unit length for normalisation
            len = 1.0 / dst;
            fx = dx * len;
            fy = dy * len;
            
            // gravitational force
            f = min(MAX_FORCE, (GRAVITY * a.mass * b.mass) / dSq);
            a.fx += f * fx * b.charge;
            a.fy += f * fy * b.charge;
            b.fx += -f * fx * a.charge;
            b.fy += -f * fy * a.charge;
          }
        }
        
        // integrate
        a.vx += a.fx;
        a.vy += a.fy;
        a.vx *= FRICTION;
        a.vy *= FRICTION;
        a.tail.unshift({
          x: a.x,
          y: a.y
        });
        if (a.tail.length > TAIL_LENGTH) {
          a.tail.pop();
        }
        a.x += a.vx;
        a.y += a.vy;
        
        // reset force
        a.fx = a.fy = 0.0;
        
        // wrap
        if (a.x > this.width + a.radius) {
          a.x = -a.radius;
          a.tail = [];
        } else if (a.x < -a.radius) {
          a.x = this.width + a.radius;
          a.tail = [];
        }
        if (a.y > this.height + a.radius) {
          a.y = -a.radius;
          a.tail = [];
        } else if (a.y < -a.radius) {
          a.y = this.height + a.radius;
          a.tail = [];
        }
        
        // draw
        this.strokeStyle = a.color;
        this.lineWidth = a.radius * 2.0;
        this.beginPath();
        this.moveTo(a.x, a.y);
        ref3 = a.tail;
        for (n = 0, len1 = ref3.length; n < len1; n++) {
          p = ref3[n];
          this.lineTo(p.x, p.y);
        }
        results.push(this.stroke());
      }
      return results;
    }
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiPGFub255bW91cz4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0E7QUFBQSxNQUFBLE1BQUEsRUFBQSxRQUFBLEVBQUEsT0FBQSxFQUFBLFNBQUEsRUFBQSxhQUFBLEVBQUEsUUFBQSxFQUFBOztFQUFBLGFBQUEsR0FBZ0I7O0VBQ2hCLFdBQUEsR0FBYzs7RUFDZCxTQUFBLEdBQVk7O0VBQ1osUUFBQSxHQUFXOztFQUNYLE9BQUEsR0FBVTs7RUFFVixNQUFBLEdBQVMsQ0FDUCxTQURPOztFQUlILFdBQU4sTUFBQSxTQUFBO0lBRUUsV0FBYSxNQUFPLEdBQVAsT0FBaUIsR0FBakIsU0FBOEIsR0FBOUIsQ0FBQTtNQUFFLElBQUMsQ0FBQTtNQUFTLElBQUMsQ0FBQTtNQUFTLElBQUMsQ0FBQTtNQUVsQyxJQUFDLENBQUEsSUFBRCxHQUFRO01BRVIsSUFBQyxDQUFBLE1BQUQsR0FBVSxJQUFDLENBQUEsSUFBRCxHQUFRO01BQ2xCLElBQUMsQ0FBQSxNQUFELEdBQVUsTUFBQSxDQUFPLENBQUUsQ0FBQyxDQUFILEVBQU0sQ0FBTixDQUFQO01BQ1YsSUFBQyxDQUFBLEtBQUQsR0FBUyxNQUFBLENBQU8sTUFBUDtNQUVULElBQUMsQ0FBQSxFQUFELEdBQU0sSUFBQyxDQUFBLEVBQUQsR0FBTTtNQUNaLElBQUMsQ0FBQSxFQUFELEdBQU0sSUFBQyxDQUFBLEVBQUQsR0FBTTtJQVREOztFQUZmOztFQWFBLE1BQU0sQ0FBQyxNQUFQLENBRUU7SUFBQSxNQUFBLEVBQVEsTUFBUjtJQUVBLFNBQUEsRUFBVyxFQUZYO0lBSUEsS0FBQSxFQUFPLFFBQUEsQ0FBQSxDQUFBO0FBRUwsVUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUEsT0FBQSxFQUFBLENBQUEsRUFBQTtBQUFBO01BQUEsS0FBUyxvREFBVDtRQUVFLENBQUEsR0FBSSxNQUFBLENBQU8sSUFBQyxDQUFBLEtBQVI7UUFDSixDQUFB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OztJQUpJO0VBZE4sQ0FGRjtBQXZCQSIsInNvdXJjZXNDb250ZW50IjpbIlxuTlVNX1BBUlRJQ0xFUyA9IDEwMDBcblRBSUxfTEVOR1RIID0gMVxuTUFYX0ZPUkNFID0gOFxuRlJJQ1RJT04gPSAwLjg5XG5HUkFWSVRZID0gMVxuICBcbkNPTE9SUyA9IFtcbiAgJyNjMGMwYzAnXG4gIF1cbiAgXG5jbGFzcyBQYXJ0aWNsZVxuICBcbiAgY29uc3RydWN0b3I6ICggQHggPSAwLjAsIEB5ID0gMC4wLCBAbWFzcyA9IDEuMCApIC0+XG5cbiAgICBAdGFpbCA9IFtdXG4gICAgXG4gICAgQHJhZGl1cyA9IEBtYXNzICogMC4xNVxuICAgIEBjaGFyZ2UgPSByYW5kb20gWyAtMSwgMSBdXG4gICAgQGNvbG9yID0gcmFuZG9tIENPTE9SU1xuICAgIFxuICAgIEBmeCA9IEBmeSA9IDAuMFxuICAgIEB2eCA9IEB2eSA9IDAuMFxuICAgIFxuU2tldGNoLmNyZWF0ZVxuXG4gIHJldGluYTogJ2F1dG8nXG4gIFxuICBwYXJ0aWNsZXM6IFtdXG4gICAgXG4gIHNldHVwOiAtPlxuICAgIFxuICAgIGZvciBpIGluIFswLi5OVU1fUEFSVElDTEVTXSBieSAxXG4gICAgICBcbiAgICAgIHggPSByYW5kb20gQHdpZHRoXG4gICAgICB5ID0gcmFuZG9tIEBoZWlnaHRcbiAgICAgIG0gPSByYW5kb20gMC41LCA4LjBcbiAgICAgICAgXG4gICAgICBAcGFydGljbGVzLnB1c2ggbmV3IFBhcnRpY2xlIHgsIHksIG1cbiAgICBcbiAgZHJhdzogLT5cblxuICAgIEBsaW5lQ2FwID0gQGxpbmVKb2luID0gJ3JvdW5kJ1xuXG4gICAgZm9yIGkgaW4gWzAuLk5VTV9QQVJUSUNMRVNdIGJ5IDFcbiAgICAgIFxuICAgICAgYSA9IEBwYXJ0aWNsZXNbaV1cblxuICAgICAgIyBpbnZlcnQgY2hhcmdlXG4gICAgICBpZiByYW5kb20oKSA8IDAuMDggdGhlbiBhLmNoYXJnZSA9IC1hLmNoYXJnZVxuICAgICAgXG4gICAgICBmb3IgaiBpbiBbaSsxLi5OVU1fUEFSVElDTEVTXSBieSAxXG4gICAgICAgIFxuICAgICAgICBiID0gQHBhcnRpY2xlc1tqXVxuICAgICAgICBcbiAgICAgICAgIyBkZWx0YSB2ZWN0b3JcbiAgICAgICAgZHggPSBiLnggLSBhLnhcbiAgICAgICAgZHkgPSBiLnkgLSBhLnlcbiAgICAgICAgXG4gICAgICAgICMgZGlzdGFuY2VcbiAgICAgICAgZHN0ID0gc3FydCBkU3EgPSAoIGR4ICogZHggKyBkeSAqIGR5ICkgKyAwLjFcbiAgICAgICAgcmFkID0gYS5yYWRpdXMgKyBiLnJhZGl1c1xuICAgICAgICBcbiAgICAgICAgaWYgZHN0ID49IHJhZFxuICAgICAgXG4gICAgICAgICAgIyBkZXJpdmF0aXZlIG9mIHVuaXQgbGVuZ3RoIGZvciBub3JtYWxpc2F0aW9uXG4gICAgICAgICAgbGVuID0gMS4wIC8gZHN0XG4gICAgICAgIFxuICAgICAgICAgIGZ4ID0gZHggKiBsZW5cbiAgICAgICAgICBmeSA9IGR5ICogbGVuXG4gICAgICAgIFxuICAgICAgICAgICMgZ3Jhdml0YXRpb25hbCBmb3JjZVxuICAgICAgICAgIGYgPSBtaW4gTUFYX0ZPUkNFLCAoIEdSQVZJVFkgKiBhLm1hc3MgKiBiLm1hc3MgKSAvIGRTcVxuICAgICAgICAgICAgXG4gICAgICAgICAgYS5meCArPSBmICogZnggKiBiLmNoYXJnZVxuICAgICAgICAgIGEuZnkgKz0gZiAqIGZ5ICogYi5jaGFyZ2VcbiAgICAgICAgICBcbiAgICAgICAgICBiLmZ4ICs9IC1mICogZnggKiBhLmNoYXJnZVxuICAgICAgICAgIGIuZnkgKz0gLWYgKiBmeSAqIGEuY2hhcmdlXG4gICAgICAgICAgXG4gICAgICAjIGludGVncmF0ZVxuICAgICAgYS52eCArPSBhLmZ4XG4gICAgICBhLnZ5ICs9IGEuZnlcbiAgICAgICAgXG4gICAgICBhLnZ4ICo9IEZSSUNUSU9OXG4gICAgICBhLnZ5ICo9IEZSSUNUSU9OXG5cbiAgICAgIGEudGFpbC51bnNoaWZ0IHg6IGEueCwgeTogYS55XG4gICAgICBhLnRhaWwucG9wKCkgaWYgYS50YWlsLmxlbmd0aCA+IFRBSUxfTEVOR1RIXG4gICAgICAgIFxuICAgICAgYS54ICs9IGEudnhcbiAgICAgIGEueSArPSBhLnZ5XG4gICAgICAgIFxuICAgICAgIyByZXNldCBmb3JjZVxuICAgICAgYS5meCA9IGEuZnkgPSAwLjBcbiAgICAgIFxuICAgICAgIyB3cmFwXG4gICAgICAgIFxuICAgICAgaWYgYS54ID4gQHdpZHRoICsgYS5yYWRpdXNcblxuICAgICAgICBhLnggPSAtYS5yYWRpdXNcbiAgICAgICAgYS50YWlsID0gW11cblxuICAgICAgZWxzZSBpZiBhLnggPCAtYS5yYWRpdXNcblxuICAgICAgICBhLnggPSBAd2lkdGggKyBhLnJhZGl1c1xuICAgICAgICBhLnRhaWwgPSBbXVxuICAgICAgXG4gICAgICBpZiBhLnkgPiBAaGVpZ2h0ICsgYS5yYWRpdXNcblxuICAgICAgICBhLnkgPSAtYS5yYWRpdXNcbiAgICAgICAgYS50YWlsID0gW11cblxuICAgICAgZWxzZSBpZiBhLnkgPCAtYS5yYWRpdXNcblxuICAgICAgICBhLnkgPSBAaGVpZ2h0ICsgYS5yYWRpdXNcbiAgICAgICAgYS50YWlsID0gW11cbiAgICAgICAgICBcbiAgICAgICMgZHJhd1xuICAgICAgQHN0cm9rZVN0eWxlID0gYS5jb2xvclxuICAgICAgQGxpbmVXaWR0aCA9IGEucmFkaXVzICogMi4wXG5cbiAgICAgIEBiZWdpblBhdGgoKVxuICAgICAgQG1vdmVUbyBhLngsIGEueVxuICAgICAgQGxpbmVUbyBwLngsIHAueSBmb3IgcCBpbiBhLnRhaWxcbiAgICAgIEBzdHJva2UoKVxuIl19
//# sourceURL=coffeescript